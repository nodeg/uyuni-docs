[[vhm-aws]]
= Virtual Host Manager and Amazon Web Services
:revdate: 2025-02-06
:page-revdate: {revdate}

// 2024-04-04 OM: It had been decided in the conversation with the mlm PO 
// that this Public Cloud related file can stay in the Uyuni books


You can use a virtual host manager (VHM) to gather instances from Amazon Web Services (AWS).

The VHM allows {productname} to obtain and report information about your clusters.
For more information on VHMs, see xref:client-configuration:vhm.adoc[].



== Create an Amazon EC2 VHM



The Virtual Host Manager (VHM) runs on the {productname} Server.

Ensure you have installed the [systemitem]``virtual-host-gatherer-libcloud`` package on the {productname} Server.


.Procedure: Creating an Amazon EC2 VHM

. In the {productname} {webui}, navigate to menu:Systems[Virtual Host Managers].
. Click btn:[Create] and select [guimenu]``Amazon EC2`` from the drop-down menu.
. In the [guimenu]``Add an Amazon EC2 Virtual Host Manager`` section, use these parameters:
* In the [guimenu]``Label`` field, type a custom name for your VHM.
* In the [guimenu]``Access Key ID`` field, type the access key ID provided by Amazon.
* In the [guimenu]``Secret Access Key`` field, type the secret access key associated with the Amazon instance.
* In the [guimenu]``Region`` field, type the region to use.
* In the [guimenu]``Zone`` field, type the zone your VM is located in.
  This is required for subscription matching to work.
  For more information about setting regions and zones, see xref:client-configuration:vhm_aws.adoc#_susesupport_and_vm_zones[].
. Click btn:[Create] to save your changes and create the VHM.
. On the [guimenu]``Virtual Host Managers`` page, select the new VHM.
. On the [guimenu]``Properties`` page, click btn:[Refresh Data] to inventory the new VHM.

To see which objects and resources have been inventoried, navigate to menu:Systems[System List > Virtual Systems].


Instances running on the Amazon public cloud report a UUID to the {productname} Server in the format of an ``i`` followed by seventeen hexadecimal digits:

----
I1234567890abcdef0
----


ifeval::[{mlm-content} == true]

== SUSE Support and VM Zones

Public cloud providers use regions to define the physical geographic location of the datacenter providing virtual machines.
For example, [systemitem]``US-East``, or [systemitem]``Asia``.

Regions are then further divided into zones.
For example, the [systemitem]``US-East`` region might contain zones called [systemitem]``us-east-2a`` and [systemitem]``us-east-2b``, among others.

{suse} uses the zone of a virtual machine to determine the appropriate subscription to provide.
If all of your VMs are provided by the same zone, you are within the terms and conditions of the ``1-2 Virtual Machines`` subscription.

If your VMs are provided by different zones, even if they are within the same region, you might not meet the conditions of the ``1-2 Virtual Machines`` subscription.
In this case, check your subscription carefully.

[NOTE]
====
For {byos} instances ({byoslongform}), all installed products are passed to the subscription matcher.
If your public cloud instances are {payg} ({payglongform}), their base products are excluded from the subscription matcher counting.

The calculation about whether an instance is {payg} or {byos} is done at the time of registration or when a hardware refresh action is executed.
====

For more information, see https://www.suse.com/products/terms_and_conditions.pdf or contact {suse}.

endif::[]




== AWS Permissions for Virtual Host Manager

For security reasons, always grant the least privilege possible for a task to be performed.
Using an Access Key with excessive permissions for users connecting to AWS is not advised.

For {productname} to gather the information required from AWS, the VHM needs permission to describe EC2 instances and addresses.
One method to grant this is to create a new IAM user (Identity and Access Management) specific to this task, create a policy as follows and attach to the user:

----
{
    "Version": "2012-10-17",
    "Statement":[
        {
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeAddresses",
                "ec2:DescribeInstances"
            ],
            "Resource": "*"
        }
    ]
}
----


You can limit permissions more by restricting access to specific regions.
For more information, see https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html#iam-example-read-only.
